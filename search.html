<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ONNA Search</title>
<style>
  :root{
    --primary:#0b78ff;
    --bg:#fafafa;
    --card:#fff;
    --muted:#9aa0a6;
    --border:#e6e6e9;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, Arial, sans-serif;
    background:var(--bg);
    color:#111;
    -webkit-font-smoothing:antialiased;
  }
  .wrap{max-width:980px;margin:16px auto;padding:12px}

  /* Search row: logo + thin pill */
  .search-row{display:flex;align-items:center;gap:10px}
  .search-pill{
    display:flex;align-items:center;
    background:var(--card);
    border:1px solid var(--border);
    border-radius:44px;
    padding:6px 8px;
    width:100%;
    box-shadow:0 1px 0 rgba(0,0,0,0.03);
    height:48px;
  }
  .mini-logo{
    width:40px;height:40px;border-radius:8px;flex:0 0 40px;display:flex;align-items:center;justify-content:center;overflow:hidden;margin-right:6px;
  }
  .mini-logo img{width:100%;height:100%;object-fit:contain;display:block}

  .search-input{
    border:0;outline:0;font-size:16px;padding:6px 10px;flex:1;min-width:0;color:#222;background:transparent;
  }
  .search-input::placeholder{color:var(--muted);font-weight:400}

  /* smaller search button inside pill (rounded) */
  .search-btn{
    background:var(--primary);color:#fff;border:0;padding:8px 14px;border-radius:28px;font-size:15px;cursor:pointer;margin-left:8px;flex:0 0 auto;
  }

  /* tabs just below, close to pill */
  .tabs-row{margin-top:8px;display:flex;align-items:center}
  .tabs{
    display:flex;gap:8px;overflow-x:auto;padding:6px;white-space:nowrap;
  }
  .tabs::-webkit-scrollbar{display:none}
  .tab{
    flex:0 0 auto;padding:8px 14px;border-radius:18px;background:#f5f5f5;border:1px solid #eee;color:#333;font-size:14px;cursor:pointer;
  }
  .tab.active{background:var(--primary);color:#fff;border-color:var(--primary)}

  /* results */
  .results{margin-top:14px}
  .card{background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 1px 0 rgba(0,0,0,0.03)}
  .title{color:var(--primary);font-size:17px;text-decoration:none;display:block}
  .snippet{color:#444;margin-top:6px;font-size:14px}
  .link{color:#2a5d2a;font-size:13px;margin-top:6px;display:block}

  /* image grid (square tiles) */
  .img-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
  .img-tile{aspect-ratio:1/1;border-radius:12px;overflow:hidden;background:#eee}
  .img-tile img{width:100%;height:100%;object-fit:cover;display:block}

  /* pagination */
  .pagination{display:flex;gap:8px;justify-content:center;padding:12px 0;flex-wrap:wrap}
  .page{padding:8px 12px;border-radius:8px;background:#fff;border:1px solid #eee;text-decoration:none;color:#333}
  .page.active{background:var(--primary);color:#fff;border-color:var(--primary)}

  .hint{color:var(--muted);padding:10px 0}

  footer{margin-top:18px;text-align:center;color:#777;padding:18px 0}

  @media(max-width:520px){
    .wrap{padding:10px}
    .mini-logo{width:36px;height:36px}
    .search-pill{height:44px;padding:5px}
    .search-input{font-size:15px}
    .search-btn{padding:7px 12px;font-size:14px}
    .img-grid{grid-template-columns:repeat(auto-fill,minmax(98px,1fr))}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="search-row">
      <div class="search-pill" style="width:100%">
        <div class="mini-logo"><img src="/minilogo.png" alt="logo"></div>
        <form id="searchForm" style="display:flex;align-items:center;flex:1" onsubmit="return onSubmit(event)">
          <input id="q" class="search-input" placeholder="Search..." autocomplete="off">
          <button class="search-btn" type="submit">Search</button>
        </form>
      </div>
    </div>

    <div class="tabs-row">
      <div id="tabs" class="tabs" role="tablist" aria-label="Search tabs">
        <div class="tab" data-type="all" id="tab-all">All</div>
        <div class="tab" data-type="picture" id="tab-picture">Picture</div>
        <div class="tab" data-type="videos" id="tab-videos">Video</div>
        <div class="tab" data-type="news" id="tab-news">News</div>
      </div>
    </div>

    <div id="results" class="results"></div>

    <div id="pagination" class="pagination" aria-hidden="true"></div>

    <footer>Â© 2025 - ONNA Network</footer>
  </div>

<script>
/* ---------- CONFIG (use your keys) ---------- */
const API_KEY = "AIzaSyAfT46n1xtT2FDlg5wfW5DEvh67WNnSHsc";
const CX = "f7849da63441147a2";

/* ---------- helpers ---------- */
function qParam(){ return new URLSearchParams(location.search).get('q') || ''; }
function typeParam(){ return new URLSearchParams(location.search).get('type') || 'all'; }
function startParam(){ return parseInt(new URLSearchParams(location.search).get('start') || '1', 10); }

/* init UI values from URL */
const qInput = document.getElementById('q');
if(qParam()) qInput.value = qParam();

/* set active tab */
function setActiveTab(){
  const t = typeParam();
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  const sel = document.querySelector(`.tab[data-type="${t}"]`);
  if(sel) sel.classList.add('active');
}
setActiveTab();

/* tab clicks */
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', ()=> {
    const t = tab.dataset.type;
    const qv = qInput.value.trim();
    const url = qv ? `/search.html?q=${encodeURIComponent(qv)}&type=${t}&start=1` : `/search.html?type=${t}`;
    location.assign(url);
  });
});

/* handle submit - navigate to same page but with type preserved (or active tab) */
function onSubmit(e){
  e.preventDefault();
  const qv = qInput.value.trim();
  if(!qv) return false;
  const t = typeParam() || document.querySelector('.tab.active')?.dataset?.type || 'all';
  location.assign(`/search.html?q=${encodeURIComponent(qv)}&type=${t}&start=1`);
  return false;
}

/* ---------- fetch & render ---------- */
const resultsEl = document.getElementById('results');
const paginationEl = document.getElementById('pagination');
const RESULTS_PER_PAGE = 10;
const MAX_PAGES = 5;

async function loadAndRender(){
  const qv = qParam();
  const t = typeParam();
  const start = startParam();

  // reset UI
  resultsEl.innerHTML = '';
  paginationEl.innerHTML = '';

  if(!qv){
    resultsEl.innerHTML = '<div class="hint">Enter your keywords and click search.</div>';
    return;
  }

  // Build query for Google CSE depending on type
  let url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(qv)}&start=${start}`;
  if(t === 'picture') url += '&searchType=image';
  if(t === 'videos') {
    // use site:youtube.com for video-like results
    url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(qv + ' site:youtube.com')}&start=${start}`;
  }
  if(t === 'news') {
    // attempt to prefer more recent items
    url += '&sort=date';
  }

  try{
    const res = await fetch(url);
    if(!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    if(data.error){
      resultsEl.innerHTML = `<div class="hint">API error: ${data.error.message}</div>`;
      return;
    }
    renderResults(data.items || [], t);
    renderPagination(qv, t, start, data.queries);
  }catch(err){
    resultsEl.innerHTML = `<div class="hint">Error: ${err.message}</div>`;
    console.error(err);
  }
}

function renderResults(items, type){
  if(type === 'picture'){
    if(items.length === 0){ resultsEl.innerHTML = '<div class="hint">No images found.</div>'; return; }
    const grid = document.createElement('div'); grid.className = 'img-grid';
    items.forEach(it=>{
      const d = document.createElement('div'); d.className='img-tile';
      // prefer thumbnail if provided, else link
      const src = it.link || (it.image && it.image.thumbnailLink) || '';
      d.innerHTML = `<img src="${src}" alt="">`;
      grid.appendChild(d);
    });
    resultsEl.appendChild(grid);
    return;
  }

  // default: list results (all, videos, news)
  if(items.length === 0){
    resultsEl.innerHTML = '<div class="hint">No results found.</div>';
    return;
  }
  items.forEach(it=>{
    const c = document.createElement('div'); c.className='card';
    const title = it.title || it.htmlTitle || 'No title';
    const link = it.link || (it.formattedUrl) || '#';
    const snippet = it.snippet || '';
    // videos: try to show site (YouTube) and create a playable link
    c.innerHTML = `<a class="title" href="${link}" target="_blank" rel="noopener">${title}</a>
                   <div class="link">${it.displayLink || link}</div>
                   <div class="snippet">${snippet}</div>`;
    resultsEl.appendChild(c);
  });
}

function renderPagination(qv, type, start, queries){
  // show simple pages 1..MAX_PAGES
  paginationEl.innerHTML = '';
  for(let i=1;i<=MAX_PAGES;i++){
    const s = 1 + (i-1)*RESULTS_PER_PAGE;
    const a = document.createElement('a');
    a.className = 'page';
    if(s === start) a.classList.add('active');
    const href = `/search.html?q=${encodeURIComponent(qv)}&type=${encodeURIComponent(type)}&start=${s}`;
    a.href = href;
    a.textContent = i;
    paginationEl.appendChild(a);
  }
}

/* run loader on page load if query present */
setActiveTab();
if(qParam()) loadAndRender();

/* small helper to ensure active tab matches path if user navigates directly */
function setActiveTab(){
  const t = typeParam() || 'all';
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  const selected = document.querySelector(`.tab[data-type="${t}"]`);
  if(selected) selected.classList.add('active');
}

</script>
</body>
</html>
